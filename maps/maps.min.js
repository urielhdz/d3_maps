function Map(e){if(typeof options==="undefined")options={};var t=this;t.highlightCountries=function(e,n,r){d3.csv("maps/relatives.csv",function(e){return{name:e.name,iso_name:e.iso_name,iso2:e.iso2,iso3:e.iso3,numcode:+e.numcode}},function(i,s){t.countries_data=s;t.applyHighlightCountries(e,n,r)})};t.applyHighlightCountries=function(e,n,r){if(typeof r==="undefined")r={};var i=r.hasOwnProperty("color")?r.color:"yellow";for(var s=0;s<e.length;s++){var o=e[s];if(o.length>3){var u=t.searchForCode(o);if(u){console.log(u);d3.select("#"+u).attr("fill",i)}}else{d3.select("#"+o).attr("fill",i)}}n()};t.searchForCode=function(e){var n=e.toLowerCase();var r=t.countries_data.filter(function(e){return e.name.toLowerCase()==n||e.iso_name.toLowerCase()==n});if(r.length>0){return r[0].iso3}return null};t.draw=function(e,n){var r=n.hasOwnProperty("width")?n.width:800;var i=n.hasOwnProperty("height")?n.height:600;var s=n.hasOwnProperty("scale")?n.scale:100;var o=n.hasOwnProperty("highlight_color")?n.highlight_color:false;t.projection=d3.geo.mercator().translate([r/2,i/2]).scale([s]);t.path=d3.geo.path().projection(t.projection);t.color=n.hasOwnProperty("color")?n.color:"#333";var u=d3.select("body").append("svg").attr({width:r,height:i});d3.json("maps/countries.geo.json",function(n){u.selectAll("path").data(n.features).enter().append("path").attr("id",function(e){return e.id}).attr("d",t.path).attr("fill",t.color).attr("class","transitionable").on("mouseover",function(){if(o){d3.select("#"+this.id).attr("fill",o)}}).on("mouseout",function(){d3.select("#"+this.id).attr("fill",t.color)});if(typeof e!="undefined")e()})}}